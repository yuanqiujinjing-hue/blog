/*
	This is the Obsidian example vault is amazing, there are a lot of dazzling features and showcase, I believe you will wonder a bit, is this Obsidian?
	[Blue-topaz-examples](https://github.com/cumany/Blue-topaz-examples)
	*/

var Me=Object.create;var q=Object.defineProperty,Ie=Object.defineProperties,De=Object.getOwnPropertyDescriptor,Fe=Object.getOwnPropertyDescriptors,qe=Object.getOwnPropertyNames,Q=Object.getOwnPropertySymbols,Pe=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var ee=(i,e,t)=>e in i?q(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,P=(i,e)=>{for(var t in e||(e={}))Z.call(e,t)&&ee(i,t,e[t]);if(Q)for(var t of Q(e))ze.call(e,t)&&ee(i,t,e[t]);return i},W=(i,e)=>Ie(i,Fe(e)),te=i=>q(i,"__esModule",{value:!0});var Re=(i,e)=>{te(i);for(var t in e)q(i,t,{get:e[t],enumerable:!0})},Be=(i,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of qe(e))!Z.call(i,n)&&n!=="default"&&q(i,n,{get:()=>e[n],enumerable:!(t=De(e,n))||t.enumerable});return i},z=i=>Be(te(q(i!=null?Me(Pe(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i);var x=(i,e,t)=>new Promise((n,o)=>{var a=r=>{try{l(t.next(r))}catch(c){o(c)}},s=r=>{try{l(t.throw(r))}catch(c){o(c)}},l=r=>r.done?n(r.value):Promise.resolve(r.value).then(a,s);l((t=t.apply(i,e)).next())});Re(exports,{default:()=>X,refresh_node:()=>N,selfDestruct:()=>F});var T=z(require("obsidian"));var S=z(require("obsidian"));function R(i,e){return i+1<e.length?e[i+1].level>e[i].level:!1}function $(i,e,t){let n,o;i instanceof MouseEvent?(i.stopPropagation(),n=e,o=t||!1):(n=i,o=e);let a=n.getAttribute("isCollapsed");a!==null&&(a==="true"?Ne(n,o):a==="false"&&Ve(n))}function Ne(i,e){i.setAttribute("isCollapsed","false");let t=parseInt(i.getAttribute("data-level")),n=i.nextElementSibling;if(e)for(;n&&parseInt(n.getAttribute("data-level"))>t;)n.style.display="block",n.getAttribute("isCollapsed")!==null&&n.setAttribute("isCollapsed","false"),n=n.nextElementSibling;else{let o=!1,a=Number.MAX_VALUE;for(;n&&parseInt(n.getAttribute("data-level"))>t;){let s=n.getAttribute("isCollapsed")!==null,l=parseInt(n.getAttribute("data-level"));o?l<=a&&(n.style.display="block",o=s,a=s?l:Number.MAX_VALUE):(s&&(o=!0,a=l),n.style.display="block"),n=n.nextElementSibling}}}function Ve(i){i.setAttribute("isCollapsed","true");let e=parseInt(i.getAttribute("data-level")),t=i.nextElementSibling;for(;t&&parseInt(t.getAttribute("data-level"))>e;)t.style.display="none",t.getAttribute("isCollapsed")!==null&&t.setAttribute("isCollapsed","true"),t=t.nextElementSibling}function ne(i,e){i.querySelectorAll("li.heading-list-item[iscollapsed]").forEach(n=>{let o=n,a=o.getAttribute("isCollapsed")==="true";e!==!a&&$(o,e)})}var xe=z(require("obsidian"));var ie={};var ae={};var se={};var oe={};var j={"ctrl + click on the floating toc to collapse/expand the header.":"ctrl + click on the floating toc to collapse/expand the header.","Floating TOC position":"Floating TOC position","Floating TOC position, default on the left side of the notes":"Floating TOC position, default on the left side of the notes","Hide heading level":"Hide heading level","Whichever option is selected, the corresponding heading level will be hidden":"Whichever option is selected, the corresponding heading level will be hidden","Plugin Settings":"Plugin Settings","Default Pin":"Default Pin","Enable Content Offset When Pinned":"Enable Content Offset When Pinned","When enabled, note content will be offset when TOC is pinned":"When enabled, note content will be offset when TOC is pinned","Enable Drag to Reorder":"Enable Drag to Reorder","When enabled, you can drag headings in TOC to reorder them in the document":"When enabled, you can drag headings in TOC to reorder them in the document","Enable Tooltip":"Enable Tooltip","Enable Search":"Enable Search","Enable quick search functionality in floating TOC. Press any key when TOC is active to start searching.":"Enable quick search functionality in floating TOC. Press any key when TOC is active to start searching.","Plugin Style Settings":"Plugin Style Settings","Mobile enabled or not":"Mobile enabled or not","Whether to enable the plugin for the mobile client, the default is enabled.":"Whether to enable the plugin for the mobile client, the default is enabled.","If the floating Toc option is not found in the style setting, please reload the style setting plugin (turn it off and on again)":"If the floating Toc option is not found in the style setting, please reload the style setting plugin (turn it off and on again)","Left alignment of TOC text":"Left alignment of TOC text","Aligned on both sides":"Aligned on both sides","Floating TOC position, on the right side of the notes":"Floating TOC position, on the right side of the notes","whether the text in TOC is left aligned":"whether the text in TOC is left aligned","When the panel is split left and right, the right side of the layout is aligned right and the left side of the panel is aligned left.":"When the panel is split left and right, the right side of the layout is aligned right and the left side of the panel is aligned left.","Set the default collapsed level of headings when initialised":"Set the default collapsed level of headings when initialised","Default Collapsed Level":"Default Collapsed Levels","Expand All Subheadings Recursively":"Expand All Subheadings Recursively","When disabled, only direct subheadings will be expanded":"When disabled, only direct subheadings will be expanded","Basic Settings":"Basic Settings","TOC Display Settings":"TOC Display Settings","Interaction Settings":"Interaction Settings","Style Settings":"Style Settings","Default Hide TOC":"Default Hide TOC","When enabled, TOC will be hidden by default when plugin starts":"When enabled, TOC will be hidden by default when plugin starts","Header single line display":"Header single line display","When enabled, heading text will be displayed in a single line":"When enabled, heading text will be displayed in a single line","Indicator bar style":"Indicator bar style","Choose the style of the indicator bar":"Choose the style of the indicator bar",Default:"Default",Icon:"Icon",Bold:"Bold","Show heading text next to indicator bar":"Show heading text next to indicator bar","When enabled, heading text will be shown next to the indicator bar":"When enabled, heading text will be shown next to the indicator bar","More Style Settings":"More Style Settings","Notice: Please click the button again,If the floating-toc option is not found in the style settings":"Notice: Please click the button again,If the floating-toc option is not found in the style settings","Search in TOC ":"Search in TOC ","Search in Floating TOC":"Search in Floating TOC",Search:"Search","Search title... ":"Search TOC title... ","Search results":"Search results","No results found":"No results found","Press Enter to jump to selected title":"Press Enter to jump to selected title","Press Escape to cancel search":"Press Escape to cancel search","Use arrow keys to navigate results":"Use arrow keys to navigate results","Close search":"Close search"};var le={};var re={};var ce={};var de={};var he={};var ge={};var ue={};var pe={};var fe={};var me={};var be={};var ve={};var ye={};var Ce={};var Te={};var Ee={};var we={"ctrl + click on the floating toc to collapse/expand the header.":"\u6309\u4F4Fctrl \u70B9\u51FB\u76EE\u5F55\u4E2D\u7684\u6807\u9898\uFF0C\u53EF\u4EE5\u4F7F\u5BF9\u5E94\u7684\u6B63\u6587\u5185\u5BB9\u6298\u53E0/\u5C55\u5F00\u3002","Floating TOC position":"\u6D6E\u52A8\u76EE\u5F55\u663E\u793A\u4F4D\u7F6E","Floating TOC position, default on the left side of the notes":"\u6D6E\u52A8\u76EE\u5F55\u663E\u793A\u4F4D\u7F6E\uFF0C\u9ED8\u8BA4\u663E\u793A\u5728\u7B14\u8BB0\u5DE6\u4FA7","Hide heading level":"\u9690\u85CF\u6307\u5B9A\u7684\u6807\u9898\u5C42\u7EA7","Whichever option is selected, the corresponding heading level will be hidden":"\u9690\u85CF\u9009\u4E2D\u7684\u6807\u9898\u5C42\u7EA7\uFF0C\u9009\u4E2D\u7684\u6807\u9898\u4E0D\u4F1A\u5728\u6D6E\u52A8\u76EE\u5F55\u4E2D\u663E\u793A\u3002","Plugin Settings":"\u63D2\u4EF6\u8BBE\u7F6E","Default Pin":"\u662F\u5426\u9ED8\u8BA4\u9489\u5728\u7B14\u8BB0\u4E0A","Enable Content Offset When Pinned":"\u56FA\u5B9A\u65F6\u542F\u7528\u7B14\u8BB0\u5185\u5BB9\u504F\u79FB","When enabled, note content will be offset when TOC is pinned":"\u542F\u7528\u540E\uFF0C\u5F53\u76EE\u5F55\u56FA\u5B9A\u65F6\u7B14\u8BB0\u5185\u5BB9\u4F1A\u81EA\u52A8\u504F\u79FB","Enable Drag to Reorder":"\u542F\u7528\u62D6\u62FD\u91CD\u6392","When enabled, you can drag headings in TOC to reorder them in the document":"\u542F\u7528\u540E\uFF0C\u53EF\u4EE5\u62D6\u62FD\u76EE\u5F55\u4E2D\u7684\u6807\u9898\u6765\u91CD\u65B0\u6392\u5217\u6587\u6863\u4E2D\u7684\u5185\u5BB9","Enable Tooltip":"\u662F\u5426\u5F00\u542F\u6807\u9898\u63D0\u793A","Enable Search":"\u542F\u7528\u641C\u7D22\u529F\u80FD","Enable quick search functionality in floating TOC. Press any key when TOC is active to start searching.":"\u542F\u7528\u6D6E\u52A8\u76EE\u5F55\u7684\u5FEB\u901F\u641C\u7D22\u529F\u80FD\u3002\u5F53\u76EE\u5F55\u6FC0\u6D3B\u65F6\u6309\u4EFB\u610F\u952E\u5F00\u59CB\u641C\u7D22\u3002","Plugin Style Settings":"\u63D2\u4EF6\u6837\u5F0F\u8BBE\u7F6E","Mobile enabled or not":"\u662F\u5426\u5728\u79FB\u52A8\u7AEF\u542F\u7528","Whether to enable the plugin for the mobile client, the default is enabled.":"\u79FB\u52A8\u5BA2\u6237\u7AEF\u662F\u5426\u542F\u7528\u63D2\u4EF6\uFF0C\u9ED8\u8BA4\u542F\u7528\u3002","If the floating Toc option is not found in the style setting, please reload the style setting plugin (turn it off and on again)":"\u5982\u679Cstyle setting \u4E2D\u65E0\u6CD5\u770B\u5230 floating Toc\u9009\u9879\uFF0C\u8BF7\u91CD\u8F7Dstyle setting\u63D2\u4EF6\uFF08\u5173\u95ED\u518D\u5F00\u542F\u5373\u53EF\uFF09","Left alignment of TOC text":"\u76EE\u5F55\u6587\u5B57\u5DE6\u5BF9\u9F50","Floating TOC position, on the right side of the notes":"\u6D6E\u52A8\u76EE\u5F55\u663E\u793A\u4F4D\u7F6E\uFF0C\u663E\u793A\u5728\u7B14\u8BB0\u53F3\u4FA7","whether the text in TOC is left aligned":"\u5F53\u5DE5\u5177\u680F\u5728\u53F3\u4FA7\u65F6\uFF0C\u76EE\u5F55\u4E2D\u7684\u6807\u9898\u662F\u5426\u5DE6\u5BF9\u9F50","Aligned on both sides":"\u4E24\u7AEF\u5BF9\u9F50","When the panel is split left and right, the right side of the layout is aligned right and the left side of the panel is aligned left.":"\u5F53\u9762\u677F\u5DE6\u53F3\u5206\u5272\u7684\u65F6\u5019\uFF0C\u53F3\u4FA7\u7248\u9762\u53F3\u5BF9\u9F50\uFF0C\u5DE6\u4FA7\u9762\u677F\u5DE6\u5BF9\u9F50\u3002","Set the default collapsed level of headings when initialised":"\u8BBE\u7F6E\u521D\u59CB\u5316\u65F6TOC\u4E2D\u9ED8\u8BA4\u6298\u53E0\u7684\u6807\u9898\u7EA7\u522B","Default Collapsed Level":"\u9ED8\u8BA4\u6298\u53E0\u7EA7\u522B","Expand All Subheadings Recursively":"\u9012\u5F52\u5C55\u5F00\u6240\u6709\u5B50\u6807\u9898","When disabled, only direct subheadings will be expanded":"\u5173\u95ED\u6B64\u9009\u9879\u65F6, \u53EA\u5C55\u5F00\u76F4\u63A5\u5B50\u6807\u9898","Basic Settings":"\u57FA\u672C\u8BBE\u7F6E","TOC Display Settings":"\u76EE\u5F55\u663E\u793A\u8BBE\u7F6E","Interaction Settings":"\u4EA4\u4E92\u8BBE\u7F6E","Style Settings":"\u6837\u5F0F\u8BBE\u7F6E","Default Hide TOC":"\u9ED8\u8BA4\u9690\u85CF\u76EE\u5F55","When enabled, TOC will be hidden by default when plugin starts":"\u542F\u7528\u540E\uFF0C\u63D2\u4EF6\u542F\u52A8\u65F6\u76EE\u5F55\u5C06\u9ED8\u8BA4\u9690\u85CF","Header single line display":"\u76EE\u5F55\u6807\u9898\u5355\u884C\u663E\u793A","When enabled, heading text will be displayed in a single line":"\u542F\u7528\u540E\uFF0C\u76EE\u5F55\u6807\u9898\u5C06\u5728\u4E00\u884C\u5185\u663E\u793A","Indicator bar style":"\u6307\u793A\u6761\u6837\u5F0F","Choose the style of the indicator bar":"\u9009\u62E9\u6307\u793A\u6761\u7684\u6837\u5F0F",Default:"\u9ED8\u8BA4",Icon:"\u56FE\u6807",Bold:"\u7C97\u4F53","Show heading text next to indicator bar":"\u5728\u6307\u793A\u6761\u65C1\u8FB9\u663E\u793A\u6807\u9898\u4E0A\u4E0B\u7EA7","When enabled, heading text will be shown next to the indicator bar":"\u542F\u7528\u540E\uFF0C\u6807\u9898\u6587\u672C\u5C06\u663E\u793A\u5728\u6307\u793A\u6761\u65C1\u8FB9","More Style Settings":"\u66F4\u591A\u6837\u5F0F\u8BBE\u7F6E","Search in TOC ":"\u5728\u76EE\u5F55\u4E2D\u641C\u7D22 ","Search in Floating TOC":"\u5728\u6D6E\u52A8\u76EE\u5F55\u4E2D\u641C\u7D22",Search:"\u641C\u7D22","Search title... ":"\u641C\u7D22\u5927\u7EB2\u6807\u9898... ","Search results":"\u641C\u7D22\u7ED3\u679C","No results found":"\u672A\u627E\u5230\u7ED3\u679C","Press Enter to jump to selected title":"\u6309\u56DE\u8F66\u952E\u8DF3\u8F6C\u5230\u9009\u4E2D\u7684\u6807\u9898","Press Escape to cancel search":"\u6309ESC\u952E\u53D6\u6D88\u641C\u7D22","Use arrow keys to navigate results":"\u4F7F\u7528\u7BAD\u5934\u952E\u5BFC\u822A\u7ED3\u679C","Close search":"\u5173\u95ED\u641C\u7D22"};var Se={"Floating TOC position":"\u6D6E\u52D5\u76EE\u9304\u986F\u793A\u4F4D\u7F6E","Floating TOC position, default on the left side of the notes":"\u6D6E\u52D5\u76EE\u9304\u986F\u793A\u4F4D\u7F6E\uFF0C\u9ED8\u8A8D\u986F\u793A\u5728\u7B46\u8A18\u5DE6\u5074","Ignore top-level headers":"\u662F\u5426\u5FFD\u7565\u9802\u7D1A\u76EE\u9304","Select whether to ignore the top-level headings. When turned on, the top-level headings in the current note are not displayed in the floating TOC.":"\u9078\u64C7\u662F\u5426\u5FFD\u7565\u9802\u7D1A\u6A19\u984C\uFF0C\u958B\u555F\u5F8C\u7576\u524D\u6587\u6A94\u4E2D\u6700\u9802\u7D1A\u7684\u6A19\u984C\u4E0D\u986F\u793A\u5728\u6D6E\u52D5\u76EE\u9304\u4E2D\u3002","Plugin Settings":"\u63D2\u4EF6\u8A2D\u7F6E","Default Pin":"\u662F\u5426\u9ED8\u8A8D\u91D8\u5728\u7B46\u8A18\u4E0A","Plugin Style Settings":"\u63D2\u4EF6\u6A23\u5F0F\u8A2D\u7F6E","Mobile enabled or not":"\u662F\u5426\u5728\u79FB\u52D5\u7AEF\u555F\u7528","Whether to enable the plugin for the mobile client, the default is enabled.":"\u79FB\u52D5\u5BA2\u6236\u7AEF\u662F\u5426\u555F\u7528\u63D2\u4EF6\uFF0C\u9ED8\u8A8D\u555F\u7528\u3002","If the floating Toc option is not found in the style setting, please reload the style setting plugin (turn it off and on again)":"\u5982\u679Cstyle setting \u4E2D\u7121\u6CD5\u770B\u5230 floating Toc\u9078\u9805\uFF0C\u8ACB\u91CD\u8F09style setting\u63D2\u4EF6\uFF08\u95DC\u9589\u518D\u958B\u555F\u5373\u53EF\uFF09","Left alignment of TOC text":"\u76EE\u9304\u6587\u5B57\u5DE6\u5C0D\u9F4A","Floating TOC position, on the right side of the notes":"\u6D6E\u52D5\u76EE\u9304\u986F\u793A\u4F4D\u7F6E\uFF0C\u986F\u793A\u5728\u7B46\u8A18\u53F3\u5074","whether the text in TOC is left or right aligned When the floating toc is on the right":"\u7576\u5DE5\u5177\u6B04\u5728\u53F3\u5074\u6642\uFF0C\u76EE\u9304\u4E2D\u7684\u6A19\u984C\u662F\u5426\u5DE6\u5C0D\u9F4A","Aligned on both sides":"\u5169\u7AEF\u5C0D\u9F4A","When the panel is split left and right, the right side of the layout is aligned right and the left side of the panel is aligned left.":"\u7576\u9762\u677F\u5DE6\u53F3\u5206\u5272\u7684\u6642\u5019\uFF0C\u53F3\u5074\u7248\u9762\u53F3\u5C0D\u9F4A\uFF0C\u5DE6\u5074\u9762\u677F\u5DE6\u5C0D\u9F4A\u3002"};var We={ar:ie,cs:ae,da:se,de:oe,en:j,"en-gb":le,es:re,fr:ce,hi:de,id:he,it:ge,ja:ue,ko:pe,nl:fe,nn:me,pl:be,pt:ve,"pt-br":ye,ro:Ce,ru:Te,tr:Ee,"zh-cn":we,"zh-tw":Se},Le=We[xe.moment.locale()];function b(i){return Le&&Le[i]||j[i]}var _=z(require("obsidian"));function He(i,e,t){let n=i[e],o=n.level,a=n.position.start.line,s=-1;for(let h=e+1;h<i.length;h++)if(i[h].level<=o){s=i[h].position.start.line;break}let l=t.split(`
`);s===-1&&(s=l.length);let c=l.slice(a,s).join(`
`);return{start:a,end:s,content:c}}function $e(i,e,t,n){return x(this,null,function*(){try{let o=i.editor,a=o.getValue(),s=He(n,e,a),l;if(t<e)l=n[t].position.start.line;else{let f=n[t];l=He(n,t,a).end}let r=a.split(`
`),c=r.slice(s.start,s.end);r.splice(s.start,s.end-s.start),l>s.start&&(l-=s.end-s.start),r.splice(l,0,...c);let h=r.join(`
`);return o.setValue(h),!0}catch(o){return console.error("\u79FB\u52A8\u6807\u9898\u5185\u5BB9\u5931\u8D25:",o),new _.Notice("\u79FB\u52A8\u6807\u9898\u5931\u8D25"),!1}})}function ke(i,e,t,n,o){!i.settings.enableDragReorder||(e.setAttribute("draggable","true"),e.addClass("draggable-heading"),e.addEventListener("dragstart",a=>{a.stopPropagation(),e.addClass("dragging"),a.dataTransfer&&(a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/plain",n.toString()))}),e.addEventListener("dragend",a=>{var l;a.stopPropagation(),e.removeClass("dragging");let s=(l=e.parentElement)==null?void 0:l.querySelectorAll(".heading-list-item");s==null||s.forEach(r=>{r.removeClass("drag-over"),r.removeClass("drag-over-top"),r.removeClass("drag-over-bottom")})}),e.addEventListener("dragover",a=>{if(a.preventDefault(),a.stopPropagation(),e.classList.contains("dragging"))return;a.dataTransfer&&(a.dataTransfer.dropEffect="move");let s=e.getBoundingClientRect(),l=s.top+s.height/2;a.clientY<l?(e.addClass("drag-over-top"),e.removeClass("drag-over-bottom")):(e.addClass("drag-over-bottom"),e.removeClass("drag-over-top"))}),e.addEventListener("dragleave",a=>{a.stopPropagation(),e.removeClass("drag-over-top"),e.removeClass("drag-over-bottom")}),e.addEventListener("drop",a=>x(this,null,function*(){var p,E;if(a.preventDefault(),a.stopPropagation(),e.removeClass("drag-over-top"),e.removeClass("drag-over-bottom"),e.classList.contains("dragging"))return;let s=(p=a.dataTransfer)==null?void 0:p.getData("text/plain");if(!s)return;let l=parseInt(s),r=n;if(l===r)return;let c=e.getBoundingClientRect(),h=c.top+c.height/2,f=r;if(a.clientY>=h&&(f=r+1),l<r&&a.clientY>=h&&(f=r),yield $e(o,l,f>l?f-1:f,i.headingdata)){new _.Notice("\u6807\u9898\u5DF2\u79FB\u52A8");let y=o.file;if(y){let m=o.contentEl.querySelector(".floating-toc");m&&m.addClass("updating"),yield new Promise(w=>{let C=i.app.metadataCache.on("changed",M=>{M.path===y.path&&(i.app.metadataCache.offref(C),w())});setTimeout(()=>{i.app.metadataCache.offref(C),w()},2e3)});let k=(E=i.app.metadataCache.getFileCache(y))==null?void 0:E.headings;if(k&&(i.headingdata=k,i.settings.ignoreHeaders)){let w=i.settings.ignoreHeaders.split(`
`);i.headingdata=k.filter(C=>!w.includes(C.level.toString()))}N(i,o),m&&setTimeout(()=>{m.removeClass("updating")},150)}}})))}function je(i,e,t,n,o,a){return x(this,null,function*(){let s=/^(?:\s*)[0-9]+\.\s/,l=/^(?:\s*)[\-\+]\s/,r,c="";(r=s.exec(t))!==null?(c=r[0],t=t.replace(s,"")):(r=l.exec(t))!==null&&(c=r[0],t=t.replace(l,""));let h=Number(n.parentElement.getAttribute("data-id")),f=Number(n.parentElement.getAttribute("data-level")),u=m=>{m.stopImmediatePropagation(),$(m,n.parentElement,i.settings.expandAllSubheadings)};n.parentElement.addEventListener("click",u),n.parentElement.hasAttribute("isCollapsed")?R(h,i.headingdata)||(n.parentElement.removeAttribute("isCollapsed"),n.parentElement.removeEventListener("click",u)):R(h,i.headingdata)&&n.parentElement.setAttribute("isCollapsed","false");let p=n;a=new S.Component,yield S.MarkdownRenderer.renderMarkdown(t,p,o,a),p&&p.classList.add("heading-rendered");let E=p.createEl("a");E.addClass("text"),E.onclick=function(m){var k;m.stopPropagation();let L=(k=parseInt(p.parentElement.getAttribute("data-line")))!=null?k:0;if(m.ctrlKey||m.metaKey)Ue(e,L);else{_e(e,L);let w=p.parentElement.parentElement.querySelector(".text-wrap.located");w&&w.removeClass("located"),p.addClass("located")}};let y=p.querySelector("p");if(y){let m=/<a[^>]*>|<\/[^>]*a>/gm;c?E.innerHTML=c+y.innerHTML.replace(m,""):E.innerHTML=y.innerHTML.replace(m,""),p.removeChild(y),i.settings.isTooltip&&(p.setAttribute("aria-label",t),i.settings.positionStyle=="right"&&p.setAttribute("aria-label-position","left"),i.settings.positionStyle=="left"&&p.setAttribute("aria-label-position","right"),i.settings.positionStyle=="both"&&p.setAttribute("aria-label-position","top"))}})}function B(i,e,t,n,o){return x(this,null,function*(){var r,c,h,f,u,p;if(!n)return;let a=t.createEl("li");a.addClass("heading-list-item"),a.setAttribute("data-level",(c=(r=n==null?void 0:n.level)==null?void 0:r.toString())!=null?c:""),a.setAttribute("data-id",o.toString()),a.setAttribute("data-line",(p=(u=(f=(h=n==null?void 0:n.position)==null?void 0:h.start)==null?void 0:f.line)==null?void 0:u.toString())!=null?p:"");let s=a.createEl("div");s.addClass("text-wrap"),yield je(i,e,n.heading,s,e.file.path,null);let l=a.createEl("div");l.addClass("line-wrap"),l.createDiv().addClass("line"),ke(i,a,n,o,e)})}var _e=(i,e)=>{i.leaf.openFile(i.file,{eState:{line:e}})},Ue=(i,e)=>{var a,s;let t=(s=(a=i==null?void 0:i.currentMode.getFoldInfo())==null?void 0:a.folds)!=null?s:[],n=e,o=0;if(t.some((l,r)=>(o=r,l.from==n)))t.splice(o,1);else{let l={from:e,to:e+1};t.push(l)}i==null||i.currentMode.applyFoldInfo({folds:t,lines:i.editor.lineCount()}),i==null||i.onMarkdownFold()};function V(i,e){var o;let t=(a,s)=>{var p,E,y;let l=i.workspace.getActiveFile(),r=i.metadataCache.getFileCache(l).headings,c=[];if(r==null||r.map(m=>{m.heading=m.heading.replace(/<\/?[\s\S]*?(?:".*")*>/g,""),c.push(m)}),e.headingdata=c,e.headingdata.length==0)return;e.settings.positionStyle=="right"?(s.addClass("floating-right"),s.removeClass("floating-left"),s.removeClass("floating-both")):e.settings.positionStyle=="left"?(s.addClass("floating-left"),s.removeClass("floating-rigth"),s.removeClass("floating-both")):e.settings.positionStyle=="both"&&(s.addClass("floating-both"),s.removeClass("floating-left"),s.removeClass("floating-rigth")),e.settings.isLeft?(s.removeClass("alignLeft"),s.addClass("alignLeft")):s.removeClass("alignLeft");let h=s.createEl("ul");h.addClass("floating-toc");let f=s.createEl("div");if(U(e,f,s),e.settings.ignoreHeaders){let m=e.settings.ignoreHeaders.split(`
`);e.headingdata=(p=i.metadataCache.getFileCache(l).headings)==null?void 0:p.filter(L=>!m.includes(L.level.toString()))}(()=>{let m=e.headingdata.length,L=i.workspace.getActiveViewOfType(S.MarkdownView);if(m>50){let k=20,w=e.headingdata.slice(0,k),C=activeDocument.createElement("div");C.className="toc-loading-indicator",C.textContent=`Loading... (${k}/${m})`,C.style.textAlign="center",C.style.padding="8px",C.style.color="var(--text-muted)",C.style.fontSize="0.8em",C.style.position="fixed",C.style.top="45px",w.forEach((g,d)=>{B(e,L,h,g,d)}),h.appendChild(C);let M=k,D=20,I=()=>{let g=Math.min(M+D,m);C.textContent=`\u52A0\u8F7D\u4E2D... (${g}/${m})`;for(let d=M;d<g;d++)B(e,L,h,e.headingdata[d],d);M=g,M<m?requestAnimationFrame(()=>{setTimeout(I,10)}):C.remove()};setTimeout(I,50)}else e.headingdata.forEach((k,w)=>{B(e,L,h,k,w)})})(),((E=a==null?void 0:a.querySelector(".markdown-source-view"))==null?void 0:E.insertAdjacentElement("beforebegin",s))||((y=a==null?void 0:a.querySelector(".markdown-reading-view"))==null||y.insertAdjacentElement("beforebegin",s))};if(this.app.workspace.getActiveViewOfType(S.MarkdownView)){(0,S.requireApiVersion)("0.15.0")?activeDocument=activeWindow.document:activeDocument=window.document;let a=e.app.workspace.getActiveViewOfType(S.MarkdownView);if(a){if((o=a.contentEl)==null?void 0:o.querySelector(".floating-toc-div"))return;{let l=createEl("div");l.addClass("floating-toc-div"),e.BAR_STYLE_CLASSES.forEach(r=>{activeDocument.body.removeClass(r)}),e.settings.isDefaultPin&&l.addClass("pin"),e.settings.isDefaultHide&&l.addClass("hide"),e.settings.enableHeadingNowrap&&activeDocument.body.addClass("enable-heading-nowrap"),e.settings.enableBarHeadingText&&activeDocument.body.addClass("enable-bar-heading-text"),e.settings.enableContentOffset&&activeDocument.body.addClass("enable-content-offset"),activeDocument.body.addClass(e.settings.barStyle||"enable-edge-style"),t(a.contentEl,l),e.updateTocWidth(l,e.headingdata),e.search&&e.search.initSearch(l)}}}}function U(i,e,t){e.addClass("toolbar"),e.addClass("hide"),new S.ButtonComponent(e).setIcon("pin").setTooltip("pin").onClick(()=>{t.classList.contains("pin")?t.removeClass("pin"):t.addClass("pin")}),new S.ButtonComponent(e).setIcon("search").setTooltip(b("Search in TOC ")).setClass("search").onClick(()=>{i.search&&i.search.startSearchFromButton()}),new S.ButtonComponent(e).setIcon("double-up-arrow-glyph").setTooltip("Scroll to Top").setClass("top").onClick(()=>{let c=this.app.workspace.getActiveViewOfType(S.MarkdownView);c&&c.setEphemeralState({scroll:0})}),new S.ButtonComponent(e).setIcon("double-down-arrow-glyph").setTooltip("Scroll to Bottom").setClass("bottom").onClick(()=>x(this,null,function*(){let c=this.app.workspace.getActiveViewOfType(S.MarkdownView);if(c){let h=this.app.workspace.getActiveFile(),u=(yield this.app.vault.cachedRead(h)).split(`
`),p=u.length;if(c.getMode()==="preview")for(;p>0&&u[p-1].trim()==="";)p--;c.currentMode.applyScroll(p-1)}})),new S.ButtonComponent(e).setIcon("copy").setTooltip("copy TOC to clipboard").setClass("copy").onClick(()=>x(this,null,function*(){let c=i.headingdata.map(h=>`${"    ".repeat(h.level-1)}- [[#${h.heading}]]`);yield navigator.clipboard.writeText(c.join(`
`)),new S.Notice("TOC Copied")}));let r=new S.ButtonComponent(e).setIcon("chevron-down").setTooltip("Collapse/Expand all headings").setClass("toggle-all").onClick(()=>{let c=t.getAttribute("data-all-expanded")==="true";r.setIcon(c?"chevron-right":"chevron-down"),ne(t,!c),t.setAttribute("data-all-expanded",(!c).toString())})}var H=z(require("obsidian"));var Ae=["left","right","both"],Oe={ignoreHeaders:"",ignoreTopHeader:!1,positionStyle:"left",isLoadOnMobile:!0,isLeft:!1,isDefaultPin:!1,isTooltip:!0,defaultCollapsedLevel:6,expandAllSubheadings:!1,isDefaultHide:!1,enableHeadingNowrap:!0,barStyle:"enable-edge-style",enableBarHeadingText:!1,enableContentOffset:!1,enableDragReorder:!1};var Y=class{constructor(e){this.checkedList=[];this.containerEl=e,this.flowListEl=this.containerEl.createDiv({cls:"check-list"})}addItem(e,t,n,o){let a=this.flowListEl.createDiv({cls:"check-item"}),s=a.createEl("input",{type:"checkbox"});return s.checked=n,s.checked&&this.checkedList.push(t),s.addEventListener("change",r=>{s.checked?this.checkedList.includes(t)||this.checkedList.push(t):this.checkedList.includes(t)&&this.checkedList.remove(t)}),s.addEventListener("change",r=>o(s.checked)),a.createDiv({cls:"flow-label"}).setText(e),a}};var K=class extends H.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t,addEventListener("refresh-toc",()=>{F(),V(e,this.plugin)})}display(){var D,I;let{containerEl:e}=this;e.empty(),e.createEl("h1",{text:"Obsidian Floating TOC "}),e.createEl("span",{text:""}).createEl("a",{text:"Author: Cuman \u2728",href:"https://github.com/cumany"}),e.createEl("span",{text:""}).createEl("a",{text:"Readme:\u4E2D\u6587",href:"https://pkmer.cn/Pkmer-Docs/10-obsidian/obsidian%E7%A4%BE%E5%8C%BA%E6%8F%92%E4%BB%B6/floating-toc/"}),e.createEl("span",{text:""}).createEl("a",{text:"|English  ",href:"https://github.com/cumany/obsidian-floating-toc-plugin/blob/master/README.md"});let t=e.createEl("div");t.addClass("callout"),t.setAttribute("data-callout","info");let n=t.createEl("div",{text:"\u{1F511}TIPS:"});n.addClass("callout-title"),n.createEl("br"),t.createEl("div",{text:b("ctrl + click on the floating toc to collapse/expand the header.")}).addClass("callout-content");let a=e.createEl("div",{cls:"floating-toc-tabs"}),s=a.createEl("div",{cls:"floating-toc-tab-header"}),l=a.createEl("div",{cls:"floating-toc-tab-content"}),r=["\u{1F3A2}TOC Display","\u{1F3AE}Interaction","\u{1F3A8}Style Settings"],c={};r.forEach(g=>{let d=s.createEl("div",{cls:"floating-toc-tab"});d.setText(g),d.addEventListener("click",()=>{s.querySelectorAll(".floating-toc-tab").forEach(A=>A.removeClass("active")),l.querySelectorAll(".floating-toc-tab-pane").forEach(A=>A.removeClass("active")),d.addClass("active"),c[g].addClass("active")});let v=l.createEl("div",{cls:"floating-toc-tab-pane"});c[g]=v}),(D=s.querySelector(".floating-toc-tab"))==null||D.addClass("active"),(I=l.querySelector(".floating-toc-tab-pane"))==null||I.addClass("active");let h=c["\u{1F3A2}TOC Display"];h.createEl("h2",{text:b("TOC Display Settings")}),new H.Setting(h).setName(b("Floating TOC position")).setDesc(this.plugin.settings.positionStyle=="both"?b("When the panel is split left and right, the right side of the layout is aligned right and the left side of the panel is aligned left."):this.plugin.settings.positionStyle=="right"?b("Floating TOC position, on the right side of the notes"):b("Floating TOC position, default on the left side of the notes")).addDropdown(g=>{let d={};Ae.map(v=>d[v]=v),g.addOptions(d),g.setValue(this.plugin.settings.positionStyle).onChange(v=>{this.plugin.settings.positionStyle=v,this.plugin.saveSettings(),setTimeout(()=>{this.display(),dispatchEvent(new Event("refresh-toc"))},100)})}),this.plugin.settings.positionStyle!="left"&&new H.Setting(h).setName(b("Left alignment of TOC text")).setDesc(b("whether the text in TOC is left aligned")).addToggle(g=>{var d;return g.setValue((d=this.plugin.settings)==null?void 0:d.isLeft).onChange(v=>{this.plugin.settings.isLeft=v,this.plugin.saveSettings(),setTimeout(()=>{this.display(),dispatchEvent(new Event("refresh-toc"))},100)})}),new H.Setting(h).setName(b("Default Hide TOC")).setDesc(b("When enabled, TOC will be hidden by default when plugin starts")).addToggle(g=>{var d;return g.setValue((d=this.plugin.settings)==null?void 0:d.isDefaultHide).onChange(v=>{this.plugin.settings.isDefaultHide=v,this.plugin.saveSettings(),setTimeout(()=>{dispatchEvent(new Event("refresh-toc"))},100)})}),new H.Setting(h).setName(b("Expand All Subheadings Recursively")).setDesc(b("When disabled, only direct subheadings will be expanded")).addToggle(g=>g.setValue(this.plugin.settings.expandAllSubheadings).onChange(d=>{this.plugin.settings.expandAllSubheadings=d,this.plugin.saveSettings(),setTimeout(()=>{dispatchEvent(new Event("refresh-toc"))},100)})),new H.Setting(h).setName(b("Hide heading level")).setDesc(b("Whichever option is selected, the corresponding heading level will be hidden"));let u=new Y(h);[1,2,3,4,5,6].forEach(g=>x(this,null,function*(){let v=this.plugin.settings.ignoreHeaders.split(`
`).includes(g.toString());u.addItem(g.toString(),g.toString(),v,A=>{this.plugin.settings.ignoreHeaders=u.checkedList.join(`
`),this.plugin.saveSettings(),setTimeout(()=>{dispatchEvent(new Event("refresh-toc"))},100)})}));let E=c["\u{1F3AE}Interaction"];E.createEl("h2",{text:b("Interaction Settings")}),new H.Setting(E).setName(b("Default Pin")).addToggle(g=>{var d;return g.setValue((d=this.plugin.settings)==null?void 0:d.isDefaultPin).onChange(v=>{this.plugin.settings.isDefaultPin=v,this.plugin.saveSettings(),setTimeout(()=>{dispatchEvent(new Event("refresh-toc"))},100)})}),new H.Setting(E).setName(b("Enable Content Offset When Pinned")).setDesc(b("When enabled, note content will be offset when TOC is pinned")).addToggle(g=>{var d;return g.setValue((d=this.plugin.settings)==null?void 0:d.enableContentOffset).onChange(v=>{this.plugin.settings.enableContentOffset=v,this.plugin.saveSettings(),setTimeout(()=>{dispatchEvent(new Event("refresh-toc"))},100)})}),new H.Setting(E).setName(b("Enable Drag to Reorder")).setDesc(b("When enabled, you can drag headings in TOC to reorder them in the document")).addToggle(g=>{var d;return g.setValue((d=this.plugin.settings)==null?void 0:d.enableDragReorder).onChange(v=>{this.plugin.settings.enableDragReorder=v,this.plugin.saveSettings(),setTimeout(()=>{dispatchEvent(new Event("refresh-toc"))},100)})}),new H.Setting(E).setName(b("Enable Tooltip")).addToggle(g=>{var d;return g.setValue((d=this.plugin.settings)==null?void 0:d.isTooltip).onChange(v=>{this.plugin.settings.isTooltip=v,this.plugin.saveSettings(),setTimeout(()=>{dispatchEvent(new Event("refresh-toc"))},100)})});let y=c["\u{1F3A8}Style Settings"];y.createEl("h2",{text:b("Style Settings")}),new H.Setting(y).setName(b("Header single line display")).setDesc(b("When enabled, heading text will be displayed in a single line")).addToggle(g=>{var d;return g.setValue((d=this.plugin.settings)==null?void 0:d.enableHeadingNowrap).onChange(v=>{this.plugin.settings.enableHeadingNowrap=v,this.plugin.saveSettings(),setTimeout(()=>{dispatchEvent(new Event("refresh-toc"))},100)})}),new H.Setting(y).setName(b("Indicator bar style")).setDesc(b("Choose the style of the indicator bar")).addDropdown(g=>{g.addOption("default-bar-style","Default").addOption("enable-edge-style","Edge").addOption("enable-bar-icon","Icon").addOption("enable-bold-bar","Bold").addOption("enable-dot-style","Dot").addOption("enable-square-style","Square").addOption("enable-vertical-line-style","Vertical Line").addOption("enable-hollow-line-style","Hollow Line").setValue(this.plugin.settings.barStyle).onChange(d=>{this.plugin.settings.barStyle=d,this.plugin.saveSettings(),setTimeout(()=>{dispatchEvent(new Event("refresh-toc"))},100)})}),new H.Setting(y).setName(b("Show heading text next to indicator bar")).setDesc(b("When enabled, heading text will be shown next to the indicator bar")).addToggle(g=>{var d;return g.setValue((d=this.plugin.settings)==null?void 0:d.enableBarHeadingText).onChange(v=>{this.plugin.settings.enableBarHeadingText=v,this.plugin.saveSettings(),setTimeout(()=>{dispatchEvent(new Event("refresh-toc"))},100)})}),y.createEl("h2",{text:b("More Style Settings")});let m=y.createEl("div");m.addClass("callout"),m.setAttribute("data-callout","warning");let L=m.createEl("div");L.addClass("callout-content"),this.app.plugins.enabledPlugins.has("obsidian-style-settings")?(L.createEl("br"),new H.ButtonComponent(L).setIcon("palette").setClass("mod-cta").setButtonText("\u{1F3A8} Open style settings").onClick(()=>{this.app.setting.open(),this.app.setting.openTabById("obsidian-style-settings"),this.app.workspace.trigger("parse-style-settings"),setTimeout(()=>{var v,A,J;let d=this.app.setting.activeTab.containerEl.querySelector(".setting-item-heading[data-id='floating-toc-styles']");d?(v=d.addClass)==null||v.call(d,"float-cta"):(this.app.workspace.trigger("parse-style-settings"),(J=(A=this.app.setting.activeTab.containerEl.querySelector(".setting-item-heading[data-id='floating-toc-styles']"))==null?void 0:A.addClass)==null||J.call(A,"float-cta"))},250)})):(L.createEl("br"),L.createEl("span",{text:""}).createEl("a",{text:"Please install or enable the style-settings plugin",href:"obsidian://show-plugin?id=obsidian-style-settings"}));let w=e.createEl("div",{cls:"cDonationSection"}),C=createEl("p"),M=createEl("p");M.appendText("If you like this Plugin and are considering donating to support continued development, use the button below!"),C.setAttribute("style","color: var(--text-muted)"),w.appendChild(M),w.appendChild(C),w.appendChild(Ye("https://github.com/cumany#thank-you-very-much-for-your-support"))}},Ye=i=>{let e=createEl("a");return e.setAttribute("href",i),e.addClass("buymeacoffee-img"),e.innerHTML='<img src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee &emoji=&slug=Cuman&button_colour=BD5FFF&font_colour=ffffff&font_family=Poppins&outline_colour=000000&coffee_colour=FFDD00" />',e};function Ke(i){return i.toLowerCase()}function Ge(i,e){let t=i.toLowerCase(),n=e.toLowerCase();if(n.includes(t)||Ke(e).includes(t))return!0;let a=t.split(""),s=n.split(""),l=0;for(let r=0;r<s.length&&l<a.length;r++)s[r]===a[l]&&l++;return l===a.length}var G=class{constructor(e){this.searchInput=null;this.searchContainer=null;this.plugin=e,this.state={isActive:!1,query:"",results:[],currentIndex:-1,searchTimeout:null}}initSearch(e){this.createSearchInput(e),this.setupKeyboardListeners(e)}createSearchInput(e){this.searchContainer=e.createEl("div",{cls:"floating-toc-search-container"}),this.searchInput=this.searchContainer.createEl("input",{type:"text",placeholder:b("Search title... "),cls:"floating-toc-search-input"});let t=this.searchContainer.createEl("button",{cls:"floating-toc-search-close"});t.innerHTML="\xD7",t.setAttribute("aria-label",b("Close search")),t.addEventListener("click",()=>{this.hideSearch()}),this.searchContainer.style.display="none",this.searchInput.addEventListener("input",n=>{let o=n.target;this.handleSearchInput(o.value)}),this.searchInput.addEventListener("keydown",n=>{n.key==="Enter"?(n.preventDefault(),this.selectCurrentResult()):n.key==="Escape"&&(n.preventDefault(),this.hideSearch())})}setupKeyboardListeners(e){document.addEventListener("keydown",t=>{if(!!this.state.isActive)switch(t.key){case"Tab":t.preventDefault(),this.navigateResults(1);break;case"ArrowUp":t.preventDefault(),this.navigateResults(-1);break;case"ArrowDown":t.preventDefault(),this.navigateResults(1);break;case"Enter":t.preventDefault(),this.selectCurrentResult();break;case"Escape":t.preventDefault(),this.hideSearch();break}})}startSearch(e){this.state.isActive=!0,this.state.query=e,this.state.currentIndex=-1,this.searchInput&&(this.searchInput.value=e,this.searchInput.style.display="block",this.searchInput.focus(),this.searchInput.select()),this.searchContainer&&(this.searchContainer.style.display="flex"),this.performSearch()}startSearchFromButton(){this.state.isActive=!0,this.state.query="",this.state.currentIndex=-1,this.searchContainer&&(this.searchContainer.style.display="flex"),this.searchInput&&(this.searchInput.value="",this.searchInput.style.display="block",setTimeout(()=>{this.searchInput.focus(),this.searchInput.select()},10));let e=document.querySelector(".floating-toc-div");e&&(e.classList.contains("pin")?e.addClass("searchonly"):(e.addClass("pin"),e.addClass("search"))),this.performSearch()}handleSearchInput(e){this.state.query=e,this.state.searchTimeout&&clearTimeout(this.state.searchTimeout),this.state.searchTimeout=window.setTimeout(()=>{this.performSearch()},100)}performSearch(){let e=document.querySelector(".floating-toc-div");if(!e)return;let t=e.querySelectorAll(".heading-list-item");if(this.state.results=[],t.forEach(n=>{n.classList.remove("search-highlight","search-current")}),!this.state.query.trim()){this.state.currentIndex=-1,this.updateResultCount(0);return}if(t.forEach(n=>{let o=n.querySelector(".text");if(o){let a=o.textContent||"";Ge(this.state.query,a)&&(this.state.results.push(n),n.classList.add("search-highlight"))}}),this.updateResultCount(this.state.results.length),this.state.results.length>0){this.state.currentIndex=0;let n=this.state.results[0];n.classList.add("search-current"),this.scrollToResult(n)}}updateResultCount(e){this.searchContainer&&this.searchContainer.setAttribute("data-result-count",`${e} results`)}navigateResults(e){if(this.state.results.length!==0&&(this.state.currentIndex>=0&&this.state.currentIndex<this.state.results.length&&this.state.results[this.state.currentIndex].classList.remove("search-current"),this.state.currentIndex+=e,this.state.currentIndex<0?this.state.currentIndex=this.state.results.length-1:this.state.currentIndex>=this.state.results.length&&(this.state.currentIndex=0),this.state.currentIndex>=0&&this.state.currentIndex<this.state.results.length)){let t=this.state.results[this.state.currentIndex];t.classList.add("search-current"),this.scrollToResult(t)}}scrollToResult(e){let t=document.querySelector(".floating-toc-div");if(!t)return;let n=t.querySelector(".floating-toc");if(!n)return;let o=e.offsetTop,a=e.offsetHeight,s=n.clientHeight,l=o-(s/2-a/2);n.scrollTo({top:Math.max(0,l),behavior:"smooth"})}selectCurrentResult(){if(this.state.currentIndex>=0&&this.state.currentIndex<this.state.results.length){let t=this.state.results[this.state.currentIndex].querySelector(".text");t&&t.click()}this.hideSearch()}hideSearch(){this.state.isActive=!1,this.state.query="",this.state.currentIndex=-1;let e=document.querySelector(".floating-toc-div");e&&(e.querySelectorAll(".heading-list-item").forEach(n=>{n.classList.remove("search-highlight","search-current")}),e.classList.contains("searchonly")?e.removeClass("searchonly"):(e.classList.contains("pin")&&e.classList.contains("search")&&e.removeClass("pin"),e.removeClass("search"))),this.searchContainer&&(this.searchContainer.style.display="none"),this.state.searchTimeout&&(clearTimeout(this.state.searchTimeout),this.state.searchTimeout=null)}isSearchActive(){return this.state.isActive}getSearchState(){return P({},this.state)}};var O;function F(){(0,T.requireApiVersion)("0.15.0")?O=activeWindow.document:O=window.document,O.querySelectorAll(".floating-toc-div").forEach(e=>{e&&e.remove()})}function N(i,e){var h,f;(0,T.requireApiVersion)("0.15.0")?O=activeWindow.document:O=window.document;let t=(h=e.contentEl)==null?void 0:h.querySelector(".floating-toc-div");if(!t)return!1;let n=t.querySelector(".toolbar");n||(n=t.createEl("div"),U(i,n,t));let o=t.querySelector("ul.floating-toc");o||(o=t.createEl("ul"),o.addClass("floating-toc"));let a=i.headingdata;if(i.settings.ignoreHeaders){let u=new Set(i.settings.ignoreHeaders.split(`
`));a=(f=i.headingdata)==null?void 0:f.filter(p=>!u.has(p.level.toString()))}if(!a)return o.remove(),!1;a&&a.length>0&&i.updateTocWidth(t,a);let s=new Map;(t==null?void 0:t.querySelectorAll("li.heading-list-item")).forEach(u=>{let p=`${u.getAttribute("data-level")}-${u.getAttribute("data-line")}-${u.children[0].innerText}`;s.set(p,u)});let r=O.createDocumentFragment(),c=new Set(s.values());return a.forEach((u,p)=>{let E=`${u.level}-${u.position.start.line}-${u.heading}`,y=s.get(E);y?(c.delete(y),R(p,i.headingdata)?y.hasAttribute("iscollapsed")||y.setAttribute("isCollapsed","false"):y.hasAttribute("iscollapsed")&&y.removeAttribute("isCollapsed"),r.appendChild(y)):B(i,e,r,u,p)}),c.forEach(u=>u.remove()),o.replaceChildren(r),!0}function Xe(i){let e=[];if(i==null?void 0:i.previousElementSibling)for(;i=i.previousElementSibling;)i.nodeType==1&&e.push(i);return e}function Je(i,e,t){var o,a,s;let n=t.target;if(((o=n.parentElement)==null?void 0:o.classList.contains("cm-editor"))||((a=n.parentElement)==null?void 0:a.classList.contains("markdown-reading-view"))){let l=i.workspace.getActiveViewOfType(T.MarkdownView);if(!l)return;let r=(s=l.currentMode.getScroll())!=null?s:0,c=e.headingdata;if(!c||c.length===0)return;let h=l.contentEl.querySelector(".floating-toc");if(!h)return;let f=h.querySelectorAll("li.heading-list-item");if(!f.length)return;let u=f[0],p=f[f.length-1],E=parseInt(u.getAttribute("data-line")||"0"),y=parseInt(p.getAttribute("data-line")||"0"),m=0,L=null;if(r<=0)m=E;else{let g=0,d=c.length-1,v=-1;for(;g<=d;){let A=Math.floor((g+d)/2);c[A].position.start.line<=r?(v=A,g=A+1):d=A-1}v!==-1?(m=c[v].position.start.line,L=c[v]):m=E}let k=h.querySelector(".heading-list-item.located");k&&k.removeClass("located");let w=h.querySelector(`li[data-line='${m}']`);if(!w)return;w.addClass("located");let C=parseInt(w.getAttribute("data-level")||"1"),M=C>1?C-1:1,D=h.querySelector("li.focus");D&&D.removeClass("focus");let I=Xe(w);for(let g=0;g<I.length;g++){let d=I[g];if(d.dataset.level<=M.toString()){d.addClass("focus");break}}requestAnimationFrame(()=>{w.scrollIntoView({block:"nearest",behavior:"smooth"})})}}var X=class extends T.Plugin{constructor(){super(...arguments);this.isUpdating=!1;this.lastRefreshTime=0;this.REFRESH_COOLDOWN=200;this.currentFile=null;this.BAR_STYLE_CLASSES=["enable-bar-heading-text","enable-heading-nowrap","enable-content-offset","pin","hide","default-bar-style","enable-edge-style","enable-bar-icon","enable-bold-bar","enable-dot-style","enable-square-style","enable-vertical-line-style","enable-hollow-line-style"];this.updateTocWidth=(0,T.debounce)((e,t)=>{let n=t.reduce((a,s)=>{let r=s.heading.split("").reduce((c,h)=>c+(/[\u4e00-\u9fa5]/.test(h)?1:.6),0);return Math.max(a,r)},0),o=Math.ceil(n)+"rem";O.body.style.setProperty("--actual-toc-width",`${o}`)},100);this.handleScroll=(e,t,n)=>(0,T.debounce)(Je(e,t,n),100)}onload(){return x(this,null,function*(){(0,T.requireApiVersion)("0.15.0")?O=activeWindow.document:O=window.document,yield this.loadSettings(),this.search=new G(this);let e=n=>{n&&(N(this,n)||V(this.app,this))};this.addCommand({id:"pin-toc-panel",name:"Pinning the Floating TOC panel",icon:"pin",callback:()=>x(this,null,function*(){let n=this.app.workspace.getActiveViewOfType(T.MarkdownView);if(n){let o=n.contentEl.querySelector(".floating-toc-div");o&&(o.classList.contains("pin")?o.removeClass("pin"):o.addClass("pin"))}})}),this.addCommand({id:"hide-toc-panel",name:"Hide/Show the Floating TOC panel",icon:"list",callback:()=>x(this,null,function*(){let n=this.app.workspace.getActiveViewOfType(T.MarkdownView);if(n){let o=n.contentEl.querySelector(".floating-toc-div");o&&(o.classList.contains("hide")?o.removeClass("hide"):o.addClass("hide"))}})}),this.addCommand({id:"scroll-to-bottom",name:"Scroll to Bottom",icon:"double-down-arrow-glyph",callback:()=>x(this,null,function*(){let n=this.app.workspace.getActiveViewOfType(T.MarkdownView);if(n){let o=this.app.workspace.getActiveFile(),s=(yield this.app.vault.cachedRead(o)).split(`
`),l=s.length;if(n.getMode()==="preview")for(;l>0&&s[l-1].trim()==="";)l--;n.currentMode.applyScroll(l-1)}})}),this.addCommand({id:"scroll-to-top",name:"Scroll to Top",icon:"double-up-arrow-glyph",callback:()=>x(this,null,function*(){let n=this.app.workspace.getActiveViewOfType(T.MarkdownView);n&&n.setEphemeralState({scroll:0})})}),this.addCommand({id:"toggle-position-style",name:"Toggle Floating TOC Position (left/right)",icon:"switch",callback:()=>{this.settings.positionStyle==="left"?this.settings.positionStyle="right":this.settings.positionStyle==="right"?this.settings.positionStyle="left":this.settings.positionStyle==="both"&&new T.Notice("Position style set to both. Toogle position only works when fixed position (left or right) is selected."),this.saveSettings(),dispatchEvent(new Event("refresh-toc"))}}),this.addCommand({id:"search-in-toc",name:"Search in Floating TOC",icon:"search",hotkeys:[{modifiers:["Alt"],key:"F"}],callback:()=>{this.search&&this.search.startSearchFromButton()}}),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{var l,r,c,h;let n=this.app.workspace.getActiveViewOfType(T.MarkdownView);if(!n)return;let o=(l=n.file)==null?void 0:l.path;if(o===this.currentFile)return;this.currentFile=o;let a=this.app.workspace.getActiveFile();if(!a||!((c=(r=this.app.metadataCache.getFileCache(a))==null?void 0:r.headings)==null?void 0:c.length)){this.headingdata=null,F();return}let s=(h=this.app.metadataCache.getFileCache(a))==null?void 0:h.headings;if(!!s){if(this.headingdata=s,this.settings.ignoreHeaders){let f=this.settings.ignoreHeaders.split(`
`);this.headingdata=s.filter(u=>!f.includes(u.level.toString()))}t(n,!0)}})),this.registerEvent(this.app.metadataCache.on("changed",()=>{var c,h;let n=this.app.workspace.getActiveViewOfType(T.MarkdownView);if(!n||((c=n.file)==null?void 0:c.path)!==this.currentFile)return;let o=n.file,a=(h=this.app.metadataCache.getFileCache(o))==null?void 0:h.headings;if(!(a==null?void 0:a.length)){this.headingdata=null,F();return}let s=a.map(f=>W(P({},f),{heading:this.removeMarkdownSyntax(f.heading)})),l=this.headingdata?this.headingdata.map(f=>W(P({},f),{heading:this.removeMarkdownSyntax(f.heading)})):null;if(this.hasStructuralHeadingChanges(s,l)){if(this.headingdata=a,this.settings.ignoreHeaders){let f=this.settings.ignoreHeaders.split(`
`);this.headingdata=a.filter(u=>!f.includes(u.level.toString()))}t(n,!0)}else this.updateOutlineLineNumbers(n,a)}));let t=(n,o=!1)=>{let a=Date.now();!o&&a-this.lastRefreshTime<this.REFRESH_COOLDOWN||(this.lastRefreshTime=a,e(n))};O.addEventListener("scroll",n=>{this.handleScroll(this.app,this,n)},!0),this.addSettingTab(new K(this.app,this)),this.app.workspace.on("window-open",n=>{console.log("window-open"),n.doc.addEventListener("scroll",o=>{this.handleScroll(this.app,this,o)},!0)}),this.app.workspace.onLayoutReady(()=>{this.app.workspace.trigger("parse-style-settings"),e(this.app.workspace.getActiveViewOfType(T.MarkdownView))})})}removeMarkdownSyntax(e){if(!e)return"";let t=e;return t=t.replace(/\*\*(.*?)\*\*/g,"$1").replace(/__(.*?)__/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/_(.*?)_/g,"$1"),t=t.replace(/`([^`]+)`/g,"$1").replace(/~~(.*?)~~/g,"$1"),t=t.replace(/==(.*?)==/g,"$1"),t=t.replace(/\[(.*?)\]\([^\)]+\)/g,"$1").replace(/\[\[(.*?)(\|.*?)?\]\]/g,"$1"),t=t.replace(/<[^>]+>/g,""),t=t.replace(/^#+\s+/,""),t.trim()}hasHeadingsChanged(e,t){if(!t||e.length!==t.length)return!0;let n=a=>`${a.heading}|${a.level}|${a.position.start.line}`;return!e.every((a,s)=>{let l=t[s],r=n(a),c=n(l);return r===c})}updateOutlineLineNumbers(e,t){var s;let n=(s=e.contentEl)==null?void 0:s.querySelector(".floating-toc-div");if(!n)return;let o=n.querySelectorAll("li.heading-list-item");if(!o.length)return;let a=new Map;t.forEach(l=>{let r=`${this.removeMarkdownSyntax(l.heading)}|${l.level}`;a.set(r,l.position.start.line)}),o.forEach(l=>{let r=l.getAttribute("data-level"),c=l.querySelector(".text-wrap a.text");if(!c)return;let f=`${c.innerText}|${r}`;if(a.has(f)){let u=a.get(f);l.getAttribute("data-line")!==u.toString()&&l.setAttribute("data-line",u.toString())}})}hasStructuralHeadingChanges(e,t){if(!t||e.length!==t.length)return!0;let n=o=>`${this.removeMarkdownSyntax(o.heading)}|${o.level}`;return e.some((o,a)=>{let s=t[a];return n(o)!==n(s)})}onunload(){var e;(0,T.requireApiVersion)("0.15.0")?O=activeWindow.document:O=window.document;try{O.removeEventListener("scroll",t=>{this.handleScroll(this.app,this,t)},!0)}catch(t){console.error("Error removing scroll event listener:",t)}try{let t=this.app.workspace.getActiveViewOfType(T.MarkdownView);if(t){let n=(e=t.contentEl)==null?void 0:e.querySelector(".floating-toc-div");n&&(n.querySelectorAll("li.heading-list-item").forEach(a=>{let s=a.cloneNode(!0);a.parentNode&&a.parentNode.replaceChild(s,a)}),n._tocCleanup&&n._tocCleanup())}}catch(t){console.error("Error cleaning up resources:",t)}F()}setHeadingdata(e){this.headingdata=e}loadSettings(){return x(this,null,function*(){this.settings=Object.assign({},Oe,yield this.loadData())})}saveSettings(){return x(this,null,function*(){yield this.saveData(this.settings)})}};

/* nosourcemap */